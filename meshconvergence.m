%% Mesh convergence analysis

% epsilon_pre = 0.1

%% Mesh global element sizze: 0.015
x_def = [1.79E-02,  1.94E-02,  2.08E-02,  2.05E-02,  1.83E-02,  1.51E-02,  1.14E-02,  7.37E-03,  3.09E-03,  -1.35E-03,  -5.80E-03,  -1.00E-02,  -1.37E-02,  -1.68E-02,  -1.90E-02,  -2.02E-02,  -2.04E-02,  -1.96E-02,  -1.78E-02,  -1.51E-02,  -1.16E-02,  -7.60E-03,  -3.21E-03,  1.35E-03,  5.84E-03,  1.00E-02,  1.37E-02,  1.68E-02,  1.89E-02,  2.02E-02,  2.02E-02,  2.04E-02,  1.96E-02,  1.78E-02,  1.51E-02,  1.17E-02,  7.72E-03,  3.34E-03,  -1.22E-03,  -5.71E-03,  -9.93E-03,  -1.36E-02,  -1.67E-02,  -1.89E-02,  -2.01E-02,  -2.04E-02,  -1.96E-02,  -1.79E-02,  -1.53E-02,  -1.18E-02,  -7.90E-03,  -3.48E-03,  9.99E-04,  5.55E-03,  9.66E-03,  1.35E-02,  1.64E-02,  1.89E-02,  2.01E-02,  2.09E-02,  2.02E-02,  1.93E-02,  1.70E-02,  1.50E-02,  1.17E-02,  9.74E-03,  6.67E-03,  6.41E-03,  5.00E-03];
y_def = [-1.11E-02,  -5.85E-03,  -1.09E-04,  5.81E-03,  1.09E-02,  1.45E-02,  1.72E-02,  1.90E-02,  2.01E-02,  2.03E-02,  1.95E-02,  1.77E-02,  1.51E-02,  1.16E-02,  7.62E-03,  3.16E-03,  -1.40E-03,  -5.92E-03,  -1.01E-02,  -1.38E-02,  -1.68E-02,  -1.90E-02,  -2.02E-02,  -2.04E-02,  -1.96E-02,  -1.78E-02,  -1.51E-02,  -1.17E-02,  -7.66E-03,  -3.27E-03,  -3.27E-03,  1.29E-03,  5.78E-03,  9.99E-03,  1.37E-02,  1.67E-02,  1.89E-02,  2.01E-02,  2.04E-02,  1.96E-02,  1.78E-02,  1.52E-02,  1.18E-02,  7.79E-03,  3.41E-03,  -1.15E-03,  -5.64E-03,  -9.87E-03,  -1.36E-02,  -1.66E-02,  -1.88E-02,  -2.02E-02,  -2.04E-02,  -1.97E-02,  -1.80E-02,  -1.55E-02,  -1.22E-02,  -8.41E-03,  -4.20E-03,  1.55E-04,  4.49E-03,  8.62E-03,  1.22E-02,  1.55E-02,  1.77E-02,  1.96E-02,  2.06E-02,  2.07E-02,  2.00E-02];
z_def = [8.89E-01,  8.78E-01,  8.65E-01,  8.52E-01,  8.39E-01,  8.26E-01,  8.12E-01,  7.99E-01,  7.86E-01,  7.72E-01,  7.59E-01,  7.46E-01,  7.32E-01,  7.19E-01,  7.06E-01,  6.92E-01,  6.79E-01,  6.66E-01,  6.52E-01,  6.39E-01,  6.26E-01,  6.13E-01,  5.99E-01,  5.86E-01,  5.73E-01,  5.59E-01,  5.46E-01,  5.33E-01,  5.19E-01,  5.06E-01,  5.06E-01,  4.93E-01,  4.79E-01,  4.66E-01,  4.53E-01,  4.39E-01,  4.26E-01,  4.13E-01,  3.99E-01,  3.86E-01,  3.73E-01,  3.59E-01,  3.46E-01,  3.33E-01,  3.19E-01,  3.06E-01,  2.93E-01,  2.79E-01,  2.66E-01,  2.53E-01,  2.39E-01,  2.26E-01,  2.13E-01,  1.99E-01,  1.86E-01,  1.73E-01,  1.59E-01,  1.46E-01,  1.33E-01,  1.19E-01,  1.06E-01,  9.28E-02,  7.96E-02,  6.62E-02,  5.30E-02,  3.97E-02,  2.67E-02,  1.30E-02,  0.00E+00];


%% Mesh global element size: 0.02
%x_def = [2.03E-02,  2.07E-02,  1.93E-02,  1.52E-02,  9.91E-03,  4.28E-03,  -1.54E-03,  -7.29E-03,  -1.25E-02,  -1.67E-02,  -1.95E-02,  -2.05E-02,  -1.97E-02,  -1.71E-02,  -1.32E-02,  -8.02E-03,  -2.22E-03,  3.80E-03,  9.47E-03,  1.43E-02,  1.79E-02,  2.00E-02,  2.03E-02,  1.89E-02,  1.59E-02,  1.14E-02,  6.02E-03,  9.24E-05,  -5.87E-03,  -1.13E-02,  -1.58E-02,  -1.89E-02,  -2.04E-02,  -2.00E-02,  -1.81E-02,  -1.45E-02,  -9.68E-03,  -3.97E-03,  1.92E-03,  7.83E-03,  1.28E-02,  1.70E-02,  1.94E-02,  2.09E-02,  2.00E-02,  1.88E-02,  1.51E-02,  1.23E-02,  8.01E-03,  6.71E-03,  5.00E-03];
%y_def = [-6.36E-03,  1.20E-03,  8.87E-03,  1.47E-02,  1.83E-02,  2.00E-02,  2.03E-02,  1.90E-02,  1.61E-02,  1.17E-02,  6.34E-03,  3.06E-04,  -5.65E-03,  -1.12E-02,  -1.56E-02,  -1.88E-02,  -2.03E-02,  -2.01E-02,  -1.81E-02,  -1.46E-02,  -9.77E-03,  -4.14E-03,  1.87E-03,  7.70E-03,  1.29E-02,  1.69E-02,  1.95E-02,  2.04E-02,  1.96E-02,  1.70E-02,  1.30E-02,  7.86E-03,  2.05E-03,  -3.96E-03,  -9.61E-03,  -1.45E-02,  -1.80E-02,  -2.01E-02,  -2.03E-02,  -1.90E-02,  -1.59E-02,  -1.17E-02,  -6.45E-03,  -8.27E-04,  4.85E-03,  1.02E-02,  1.45E-02,  1.79E-02,  2.00E-02,  2.08E-02,  2.00E-02];
%z_def = [8.90E-01,  8.74E-01,  8.56E-01,  8.39E-01,  8.21E-01,  8.03E-01,  7.86E-01,  7.68E-01,  7.50E-01,  7.32E-01,  7.14E-01,  6.96E-01,  6.78E-01,  6.60E-01,  6.43E-01,  6.25E-01,  6.07E-01,  5.89E-01,  5.71E-01,  5.53E-01,  5.35E-01,  5.18E-01,  5.00E-01,  4.82E-01,  4.64E-01,  4.46E-01,  4.28E-01,  4.10E-01,  3.93E-01,  3.75E-01,  3.57E-01,  3.39E-01,  3.21E-01,  3.03E-01,  2.85E-01,  2.68E-01,  2.50E-01,  2.32E-01,  2.14E-01,  1.96E-01,  1.78E-01,  1.60E-01,  1.43E-01,  1.25E-01,  1.07E-01,  8.89E-02,  7.12E-02,  5.32E-02,  3.58E-02,  1.76E-02,  0.00E+00];

%% Mesh global element size: 0.025
%x_def = [2.17E-02,  1.87E-02,  1.30E-02,  5.60E-03,  -1.67E-03,  -8.55E-03,  -1.46E-02,  -1.87E-02,  -2.05E-02,  -1.95E-02,  -1.60E-02,  -1.03E-02,  -3.46E-03,  3.92E-03,  1.07E-02,  1.62E-02,  1.96E-02,  2.04E-02,  1.86E-02,  1.45E-02,  8.38E-03,  1.30E-03,  -6.04E-03,  -1.25E-02,  -1.75E-02,  -2.01E-02,  -2.02E-02,  -1.76E-02,  -1.29E-02,  -6.39E-03,  7.33E-04,  8.02E-03,  1.39E-02,  1.86E-02,  2.02E-02,  2.07E-02,  1.78E-02,  1.48E-02,  9.50E-03,  7.08E-03,  5.00E-03];
%y_def = [6.59E-04,  9.70E-03,  1.69E-02,  2.00E-02,  2.05E-02,  1.84E-02,  1.44E-02,  8.19E-03,  1.04E-03,  -6.40E-03,  -1.28E-02,  -1.77E-02,  -2.02E-02,  -2.01E-02,  -1.74E-02,  -1.25E-02,  -5.95E-03,  1.32E-03,  8.47E-03,  1.45E-02,  1.87E-02,  2.04E-02,  1.96E-02,  1.62E-02,  1.07E-02,  3.87E-03,  -3.45E-03,  -1.04E-02,  -1.59E-02,  -1.95E-02,  -2.04E-02,  -1.90E-02,  -1.49E-02,  -9.38E-03,  -2.57E-03,  4.33E-03,  1.07E-02,  1.58E-02,  1.91E-02,  2.08E-02,  2.00E-02];
%z_def = [8.90E-01,  8.70E-01,  8.48E-01,  8.26E-01,  8.04E-01,  7.82E-01,  7.59E-01,  7.37E-01,  7.14E-01,  6.92E-01,  6.70E-01,  6.48E-01,  6.25E-01,  6.03E-01,  5.81E-01,  5.58E-01,  5.36E-01,  5.14E-01,  4.91E-01,  4.69E-01,  4.47E-01,  4.24E-01,  4.02E-01,  3.80E-01,  3.57E-01,  3.35E-01,  3.13E-01,  2.90E-01,  2.68E-01,  2.46E-01,  2.23E-01,  2.01E-01,  1.79E-01,  1.56E-01,  1.34E-01,  1.11E-01,  8.93E-02,  6.66E-02,  4.48E-02,  2.21E-02,  0.00E+00];


%% Mesh global element size: 0.03
%x_def = [2.03E-02,  1.22E-02,  2.70E-03,  -6.13E-03,  -1.35E-02,  -1.86E-02,  -2.06E-02,  -1.86E-02,  -1.33E-02,  -5.53E-03,  3.08E-03,  1.12E-02,  1.73E-02,  2.03E-02,  1.97E-02,  1.55E-02,  8.60E-03,  1.24E-04,  -8.31E-03,  -1.53E-02,  -1.95E-02,  -2.04E-02,  -1.74E-02,  -1.15E-02,  -3.43E-03,  5.00E-03,  1.29E-02,  1.80E-02,  2.09E-02,  1.95E-02,  1.70E-02,  1.11E-02,  7.54E-03,  5.00E-03];
%y_def = [9.36E-03,  1.74E-02,  2.10E-02,  1.95E-02,  1.54E-02,  8.38E-03,  -7.47E-05,  -8.77E-03,  -1.56E-02,  -1.97E-02,  -2.03E-02,  -1.72E-02,  -1.10E-02,  -2.86E-03,  5.79E-03,  1.34E-02,  1.86E-02,  2.05E-02,  1.87E-02,  1.36E-02,  6.06E-03,  -2.53E-03,  -1.07E-02,  -1.69E-02,  -2.03E-02,  -1.98E-02,  -1.62E-02,  -9.52E-03,  -1.80E-03,  6.33E-03,  1.32E-02,  1.80E-02,  2.07E-02,  2.00E-02];
%z_def = [8.91E-01,  8.66E-01,  8.39E-01,  8.13E-01,  7.86E-01,  7.58E-01,  7.31E-01,  7.04E-01,  6.77E-01,  6.50E-01,  6.23E-01,  5.96E-01,  5.69E-01,  5.42E-01,  5.15E-01,  4.88E-01,  4.61E-01,  4.33E-01,  4.06E-01,  3.79E-01,  3.52E-01,  3.25E-01,  2.98E-01,  2.71E-01,  2.44E-01,  2.17E-01,  1.90E-01,  1.63E-01,  1.35E-01,  1.09E-01,  8.10E-02,  5.44E-02,  2.69E-02,  0.00E+00];

%% Mesh global element size: 0.035
%x_def = [1.64E-02,  4.58E-03,  -6.19E-03,  -1.42E-02,  -1.94E-02,  -2.03E-02,  -1.67E-02,  -9.11E-03,  2.31E-04,  9.65E-03,  1.68E-02,  2.03E-02,  1.93E-02,  1.41E-02,  5.74E-03,  -3.89E-03,  -1.26E-02,  -1.86E-02,  -2.05E-02,  -1.79E-02,  -1.13E-02,  -2.43E-03,  7.25E-03,  1.48E-02,  2.00E-02,  2.02E-02,  1.83E-02,  1.23E-02,  7.93E-03,  5.00E-03];
%y_def = [1.60E-02,  2.08E-02,  2.00E-02,  1.46E-02,  6.75E-03,  -3.09E-03,  -1.21E-02,  -1.84E-02,  -2.05E-02,  -1.81E-02,  -1.17E-02,  -2.74E-03,  6.84E-03,  1.49E-02,  1.97E-02,  2.02E-02,  1.61E-02,  8.65E-03,  -8.24E-04,  -1.00E-02,  -1.72E-02,  -2.03E-02,  -1.94E-02,  -1.39E-02,  -6.16E-03,  2.97E-03,  1.11E-02,  1.70E-02,  2.06E-02,  2.00E-02];
%z_def = [8.92E-01,  8.63E-01,  8.33E-01,  8.02E-01,  7.71E-01,  7.40E-01,  7.10E-01,  6.79E-01,  6.48E-01,  6.17E-01,  5.86E-01,  5.55E-01,  5.25E-01,  4.94E-01,  4.63E-01,  4.32E-01,  4.01E-01,  3.70E-01,  3.40E-01,  3.09E-01,  2.78E-01,  2.47E-01,  2.16E-01,  1.85E-01,  1.54E-01,  1.24E-01,  9.25E-02,  6.20E-02,  3.07E-02,  0.00E+00];

%% Mesh global element size: 0.04
%x_def = [7.39E-03,  -6.74E-03,  -1.60E-02,  -2.01E-02,  -1.93E-02,  -1.26E-02,  -2.55E-03,  8.34E-03,  1.67E-02,  2.05E-02,  1.86E-02,  1.16E-02,  1.37E-03,  -9.23E-03,  -1.72E-02,  -2.06E-02,  -1.82E-02,  -1.09E-02,  -4.92E-04,  9.72E-03,  1.77E-02,  2.04E-02,  1.95E-02,  1.37E-02,  8.45E-03,  5.00E-03];
%y_def = [2.24E-02,  2.01E-02,  1.33E-02,  3.41E-03,  -7.37E-03,  -1.63E-02,  -2.05E-02,  -1.88E-02,  -1.20E-02,  -1.85E-03,  8.76E-03,  1.70E-02,  2.05E-02,  1.84E-02,  1.12E-02,  9.39E-04,  -9.66E-03,  -1.74E-02,  -2.07E-02,  -1.79E-02,  -1.10E-02,  -1.09E-03,  8.47E-03,  1.57E-02,  2.04E-02,  2.00E-02];
%z_def = [8.93E-01,  8.59E-01,  8.24E-01,  7.88E-01,  7.52E-01,  7.17E-01,  6.81E-01,  6.45E-01,  6.09E-01,  5.74E-01,  5.38E-01,  5.02E-01,  4.66E-01,  4.30E-01,  3.94E-01,  3.59E-01,  3.23E-01,  2.87E-01,  2.51E-01,  2.15E-01,  1.79E-01,  1.44E-01,  1.08E-01,  7.21E-02,  3.58E-02,  0.00E+00];


%% Mesh global element size: 0.045

%x_def = [-4.67E-03,  -1.63E-02,  -2.06E-02,  -1.81E-02,  -9.91E-03,  2.24E-03,  1.30E-02,  1.98E-02,  1.97E-02,  1.33E-02,  2.38E-03,  -9.15E-03,  -1.79E-02,  -2.05E-02,  -1.66E-02,  -7.11E-03,  4.45E-03,  1.49E-02,  1.99E-02,  2.03E-02,  3.55E-02,  8.91E-03,  5.00E-03];
%y_def = [2.37E-02,  1.35E-02,  1.95E-03,  -9.48E-03,  -1.82E-02,  -2.06E-02,  -1.60E-02,  -6.02E-03,  5.80E-03,  1.57E-02,  2.05E-02,  1.84E-02,  1.03E-02,  -1.18E-03,  -1.22E-02,  -1.94E-02,  -2.00E-02,  -1.46E-02,  -4.51E-03,  6.10E-03,  8.25E-03,  2.02E-02,  2.00E-02];
%z_def = [8.94E-01,  8.56E-01,  8.16E-01,  7.75E-01,  7.34E-01,  6.94E-01,  6.53E-01,  6.12E-01,  5.71E-01,  5.31E-01,  4.90E-01,  4.49E-01,  4.08E-01,  3.68E-01,  3.27E-01,  2.86E-01,  2.45E-01,  2.04E-01,  1.64E-01,  1.23E-01,  8.87E-02,  4.08E-02,  0.00E+00];

%% Code to find tau

% Using arctan2(y,x) to find the angle (in radians) between the deformed x coordinates and the y deformed coordinates
theta_def = atan2(y_def, x_def); 

% Unwrapping the angle to determine the 'true' angles displaced
theta_def_unwrapped = unwrap(theta_def); 

% Finding the total twist by accumulating the unwrapped angles
total_twist = theta_def_unwrapped(end) - theta_def_unwrapped(1);

% Determining the arc length of the helix formed
L_arc = z_def(1) - z_def(end);  

% Defining the initial length of the structure
L = 1;

% Finding the twist per unit length
tau = total_twist / L;

% Finding the number of rotations the helix makes
turns = total_twist / (2 * pi);
